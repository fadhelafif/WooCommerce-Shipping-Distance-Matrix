!function(u){"use strict";function o(n,a,i){var s;return function(){var e=this,o=arguments,t=i&&!s;clearTimeout(s),s=setTimeout(function(){s=null,i||n.apply(e,o)},a),t&&n.apply(e,o)}}var t=window.console.error;window.console.error=function(){var e=arguments[0];1!==e.indexOf("https://developers.google.com/maps/documentation/javascript/error-messages")&&n._showMapError(e),t.apply(t,arguments)};var n={_zoomLevel:16,init:function(e){var a=this;a.params=e,a.params.showSettings&&setTimeout(function(){for(var e=!1,o=u(document).find(".wc-shipping-zone-method-type"),t=0;t<o.length;t++){var n=o[t];if(u(n).text()===a.params.methodTitle)return u(n).closest("tr").find(".row-actions .wc-shipping-zone-method-settings").trigger("click"),void(e=!0)}e||(u(".wc-shipping-zone-add-method").trigger("click"),u('select[name="add_method_id"]').val(a.params.methodId).trigger("change"))},200),u(document).on("click",".wc-shipping-zone-method-settings",function(){if(u(this).closest("tr").find(".wc-shipping-zone-method-type").text()!==a.params.methodTitle)return!1;u("#woocommerce_wcsdm_gmaps_api_units").trigger("change"),u("#woocommerce_wcsdm_gmaps_api_key").trigger("input")}),u(document).on("input","#woocommerce_wcsdm_gmaps_api_key",o(function(){a._initGoogleMaps()},250)),u(document).on("change","#woocommerce_wcsdm_origin_lat, #woocommerce_wcsdm_origin_lng",o(function(){u("#woocommerce_wcsdm_origin_lat").val().length&&u("#woocommerce_wcsdm_origin_lng").val().length&&a._initGoogleMaps()},250)),u(document).on("change","#woocommerce_wcsdm_gmaps_api_units",function(){u(".field-group.distance .field-group-icon").text(a.params.i18n.distance[u(this).val()].unit),u('option[value="per_unit"]').text(a.params.i18n.distance[u(this).val()].perUnit)}),u(document).on("change","#rates-list-table thead .select-item",a._toggleRateRowsBulk),u(document).on("change","#rates-list-table tbody .select-item",a._toggleRateRows),u(document).on("click","#rates-list-table .button.add_row",a._addRateRows),u(document).on("click","#rates-list-table .button.remove_rows",a._removeRateRows)},_initGoogleMaps:function(){var e=this;u("#wcsdm-map-wrapper").show().siblings(".description").hide();var o=u("#woocommerce_wcsdm_gmaps_api_key").val();if(o.length){void 0!==window.google&&(window.google=void 0);var t="https://maps.googleapis.com/maps/api/js?libraries=geometry,places&key="+o+"&language="+e.params.language;u.getScript(t,function(){e._buildGoogleMaps()})}},_buildGoogleMaps:function(){var t=this,e=-6.175392,o=106.827153,n=u("#woocommerce_wcsdm_origin_lat").val(),a=u("#woocommerce_wcsdm_origin_lng").val(),i={lat:n=n.length?parseFloat(n):e,lng:a=a.length?parseFloat(a):o},s=wp.template("wcsdm-map-canvas"),c=wp.template("wcsdm-map-search");u("#wcsdm-map-canvas").length||u("#wcsdm-map-wrapper").append(s());var r=[],d=new google.maps.Map(document.getElementById("wcsdm-map-canvas"),{center:i,zoom:t._zoomLevel,mapTypeId:"roadmap"}),g=new google.maps.Marker({map:d,position:i,draggable:!0,icon:t.params.marker}),p=new google.maps.InfoWindow({maxWidth:350});n===e&&a===o?(p.setContent(t.params.i18n.dragMarker),p.open(d,g)):t._setLatLng(g.position,g,d,p),google.maps.event.addListener(g,"dragstart",function(){p.close()}),google.maps.event.addListener(g,"dragend",function(e){t._setLatLng(e.latLng,g,d,p)}),r.push(g),u("#wcsdm-map-search").length||u("#wcsdm-map-wrapper").append(c());var m=document.getElementById("wcsdm-map-search"),l=new google.maps.places.SearchBox(m);d.controls[google.maps.ControlPosition.TOP_LEFT].push(m),d.addListener("bounds_changed",function(){l.setBounds(d.getBounds())}),l.addListener("places_changed",function(){var e=l.getPlaces();if(0!==e.length){r.forEach(function(e){e.setMap(null)}),r=[];var o=new google.maps.LatLngBounds;e.forEach(function(e){e.geometry?(g=new google.maps.Marker({map:d,position:e.geometry.location,draggable:!0,icon:t.params.marker}),t._setLatLng(e.geometry.location,g,d,p),google.maps.event.addListener(g,"dragstart",function(){p.close()}),google.maps.event.addListener(g,"dragend",function(e){t._setLatLng(e.latLng,g,d,p)}),r.push(g),e.geometry.viewport?o.union(e.geometry.viewport):o.extend(e.geometry.location)):console.log("Returned place contains no geometry")}),d.fitBounds(o)}})},_showMapError:function(e){u("#wcsdm-map-wrapper").empty().hide().siblings(".description").show("fast",function(){window.alert(e)})},_setLatLng:function(e,t,n,a){(new google.maps.Geocoder).geocode({latLng:e},function(e,o){o===google.maps.GeocoderStatus.OK&&e[0]&&(a.setContent(e[0].formatted_address),a.open(n,t),t.addListener("click",function(){a.open(n,t)}))}),n.setCenter(e),u("#woocommerce_wcsdm_origin_lat").val(e.lat()),u("#woocommerce_wcsdm_origin_lng").val(e.lng())},_toggleRateRowsBulk:function(e){var o=u(e.currentTarget),t=o.closest("table").find("tbody input[type=checkbox]");t.length?t.prop("checked",o.is(":checked")).trigger("change"):o.prop("checked",!o.is(":checked"))},_toggleRateRows:function(e){var o=u(e.currentTarget).closest("table"),t=o.find("thead"),n=o.find("tbody"),a=o.find("tfoot");n.find("[type=checkbox]:checked").length?a.find(".add_row").hide("fast",function(){u(this).siblings(".remove_rows").show()}):a.find(".remove_rows").hide("fast",function(){u(this).siblings(".add_row").show()}),n.find("[type=checkbox]:checked").length===n.find("[type=checkbox]").length?t.find("input[type=checkbox]").prop("checked",!0):t.find("input[type=checkbox]").prop("checked",!1)},_addRateRows:function(e){e.preventDefault(),u("#rates-list-table tbody").append(wp.template("rates-list-input-table-row")).find("tr:last-child .field-distance").focus(),u("#woocommerce_wcsdm_gmaps_api_units").trigger("change")},_removeRateRows:function(e){e.preventDefault();var o=u(e.currentTarget),t=o.closest("table");o.hide("fast",function(){u(this).siblings(".add_row").show()}),t.find("thead [type=checkbox]").prop("checked",!1),t.find("tbody [type=checkbox]:checked").each(function(e,o){u(o).closest("tr").remove()})}};u(document).ready(function(){n.init(wcsdm_params)})}(jQuery);