!function(g){"use strict";function t(n,a,s){var i;return function(){var e=this,t=arguments,o=s&&!i;clearTimeout(i),i=setTimeout(function(){i=null,s||n.apply(e,t)},a),o&&n.apply(e,t)}}var w,a,h=!1,e=window.console.error;window.console.error=function(){1!==arguments[0].indexOf("google.com")&&(h=!0,u._showMapError(arguments[0])),e.apply(e,arguments)};var o=0,u={_zoomLevel:16,init:function(e){u.params=e,u.params.showSettings&&setTimeout(function(){for(var e=!1,t=g(document).find(".wc-shipping-zone-method-type"),o=0;o<t.length;o++){var n=t[o];if(g(n).text()===u.params.methodTitle)return g(n).closest("tr").find(".row-actions .wc-shipping-zone-method-settings").trigger("click"),void(e=!0)}e||(g(".wc-shipping-zone-add-method").trigger("click"),g('select[name="add_method_id"]').val(u.params.methodId).trigger("change"))},200),g(document).on("click",".wc-shipping-zone-method-settings",function(){if(g(this).closest("tr").find(".wc-shipping-zone-method-type").text()!==u.params.methodTitle)return!1;g(".field-distance").trigger("change"),g("#woocommerce_wcsdm_gmaps_api_units").trigger("change"),g("#woocommerce_wcsdm_gmaps_api_key").trigger("input"),u._toggleNoRatesRow()}),g(document).on("input","#woocommerce_wcsdm_gmaps_api_key",t(function(){u._initGoogleMaps()},250)),g(document).on("change","#woocommerce_wcsdm_origin_lat, #woocommerce_wcsdm_origin_lng",t(function(){g("#woocommerce_wcsdm_origin_lat").val().length&&g("#woocommerce_wcsdm_origin_lng").val().length&&u._initGoogleMaps()},250)),g(document).on("change","#woocommerce_wcsdm_gmaps_api_units",function(){g(".field-groups.distance .field-group-item-units").text(u.params.i18n.distance[g(this).val()].unit),g('option[value="per_unit"]').text(u.params.i18n.distance[g(this).val()].perUnit)}),g(document).on("change","#woocommerce_wcsdm_gmaps_api_units",function(){g(".field-groups.distance .field-group-item-units").text(u.params.i18n.distance[g(this).val()].unit),g('option[value="per_unit"]').text(u.params.i18n.distance[g(this).val()].perUnit)}),g(document).on("change input",".field-distance",function(e){var t=g(e.currentTarget),o=parseInt(t.val());o<10?t.attr("step","1"):10<=o&&o<=50?t.attr("step","5"):t.attr("step","10")}),g(document).on("change","#wcsdm-table-rates tbody .wcsdm-input-dummy",function(e){g(e.currentTarget).closest("td").find(".wcsdm-input").val(g(e.currentTarget).val())}),g(document).on("change","#woocommerce_wcsdm_free",function(e){g(".free-shipping-yes_alt").closest("tr").hide(),"yes_alt"===g(e.currentTarget).val()&&g(".free-shipping-yes_alt").closest("tr").show()}),g(document).on("click",".advanced-rate-settings",function(e){e.preventDefault();var t=g(e.currentTarget).closest("tr").removeClass("applied");t.siblings().removeClass("applied"),t.find(".wcsdm-input").each(function(){g("#"+g(this).data("id")).val(g(this).val()).attr("name","").trigger("change")}),a=t.index(),o=Math.abs(t.closest("form").position().top),g(e.currentTarget).closest("section").find(".wcsdm-table-row-advanced").show().siblings().hide(),g("#btn-ok").hide().after(wp.template("btn-advanced")),g("#woocommerce_wcsdm_free").trigger("change")}),g(document).on("click","#btn-dummy",function(e){var n;e.preventDefault(),g("#wcsdm-table-advanced .wcsdm-input").each(function(){var e=g(this),t=e.val(),o=e.attr("id");(n=g("#wcsdm-table-rates tbody tr:eq("+a+")").addClass("applied").find(".wcsdm-input."+o).val(t)).hasClass("wcsdm-input-free")?n.closest("td").find(".dashicons").removeClass().addClass("dashicons").addClass("free-shipping-"+t):n.closest("td").find(".wcsdm-input-dummy").val(t),e.val("")}),g(e.currentTarget).closest("section").find(".wcsdm-table-row-advanced").hide().siblings().show(),g(e.currentTarget).remove(),g("#btn-ok").show(),g(".wc-modal-shipping-method-settings").animate({scrollTop:o},500),setTimeout(function(){n&&n.closest("tr").removeClass("applied")},1e3)}),g(document).on("change","#wcsdm-table-rates thead .select-item",u._toggleRateRowsBulk),g(document).on("change","#wcsdm-table-rates tbody .select-item",u._toggleRateRows),g(document).on("click","#wcsdm-table-rates .button.add_row",u._addRateRows),g(document).on("click","#wcsdm-table-rates .button.remove_rows",u._removeRateRows)},_initGoogleMaps:function(){g("#wcsdm-map-error").hide().empty(),g("#wcsdm-map-wrapper").hide().empty(),g("#wcsdm-lat-lng-wrap").hide();var e=g("#woocommerce_wcsdm_gmaps_api_key").val();if(e.length){g("#wcsdm-map-wrapper").closest("tr").show(),h=!1,void 0!==window.google&&(window.google=void 0);var t="https://maps.googleapis.com/maps/api/js?libraries=geometry,places&key="+e+"&language="+u.params.language;g.getScript(t,function(){u._buildGoogleMaps()})}else g("#wcsdm-map-wrapper").closest("tr").hide()},_buildGoogleMaps:function(){var e=-6.175392,t=106.827153,o=g("#woocommerce_wcsdm_origin_lat").val(),n=g("#woocommerce_wcsdm_origin_lng").val(),a={lat:o=o.length?parseFloat(o):e,lng:n=n.length?parseFloat(n):t},s=wp.template("wcsdm-map-canvas"),i=wp.template("wcsdm-map-search");g("#wcsdm-map-canvas").length||g("#wcsdm-map-wrapper").append(s());var c=[],r=new google.maps.Map(document.getElementById("wcsdm-map-canvas"),{center:a,zoom:u._zoomLevel,mapTypeId:"roadmap"}),d=new google.maps.Marker({map:r,position:a,draggable:!0,icon:u.params.marker}),l=new google.maps.InfoWindow({maxWidth:350});o===e&&n===t?(l.setContent(u.params.i18n.dragMarker),l.open(r,d)):u._setLatLng(d.position,d,r,l),google.maps.event.addListener(d,"dragstart",function(){l.close()}),google.maps.event.addListener(d,"dragend",function(e){u._setLatLng(e.latLng,d,r,l)}),c.push(d),g("#wcsdm-map-search").length||g("#wcsdm-map-wrapper").append(i());var m=document.getElementById("wcsdm-map-search"),p=new google.maps.places.SearchBox(m);r.controls[google.maps.ControlPosition.TOP_LEFT].push(m),r.addListener("bounds_changed",function(){p.setBounds(r.getBounds())}),p.addListener("places_changed",function(){var e=p.getPlaces();if(0!==e.length){c.forEach(function(e){e.setMap(null)}),c=[];var t=new google.maps.LatLngBounds;e.forEach(function(e){e.geometry?(d=new google.maps.Marker({map:r,position:e.geometry.location,draggable:!0,icon:u.params.marker}),u._setLatLng(e.geometry.location,d,r,l),google.maps.event.addListener(d,"dragstart",function(){l.close()}),google.maps.event.addListener(d,"dragend",function(e){u._setLatLng(e.latLng,d,r,l)}),c.push(d),e.geometry.viewport?t.union(e.geometry.viewport):t.extend(e.geometry.location)):console.log("Returned place contains no geometry")}),r.fitBounds(t)}}),g("#wcsdm-map-wrapper").show(),g("#wcsdm-lat-lng-wrap").show(),clearTimeout(w),w=setTimeout(function(){if(!h){var e=new google.maps.LatLng(-6.1762256,106.82295120000003),t=new google.maps.LatLng(-6.194891755155254,106.81979692219852);(new google.maps.DistanceMatrixService).getDistanceMatrix({origins:[e],destinations:[t],travelMode:"DRIVING",unitSystem:google.maps.UnitSystem.METRIC},function(e,t){console.log("DistanceMatrix.testRequest",{status:t,response:e})})}},800)},_showMapError:function(e){g("#wcsdm-map-wrapper").empty().hide(),g("#wcsdm-lat-lng-wrap").hide().find(".origin-coordinates").val("");g("#wcsdm-map-error").html(e.replace(/(\b(https?|ftp|file):\/\/[-A-Z0-9+&@#\/%?=~_|!:,.;]*[-A-Z0-9+&@#\/%=~_|])/gi,'<a href="$1" target="_blank">$1</a>')).show()},_setLatLng:function(e,o,n,a){(new google.maps.Geocoder).geocode({latLng:e},function(e,t){t===google.maps.GeocoderStatus.OK&&e[0]&&(a.setContent(e[0].formatted_address),a.open(n,o),o.addListener("click",function(){a.open(n,o)}))}),n.setCenter(e),g("#woocommerce_wcsdm_origin_lat").val(e.lat()),g("#woocommerce_wcsdm_origin_lng").val(e.lng())},_toggleRateRowsBulk:function(e){var t=g(e.currentTarget),o=t.closest("table").find("tbody input[type=checkbox]");o.length?(o.prop("checked",t.is(":checked")).trigger("change"),t.is(":checked")&&g(".wc-modal-shipping-method-settings").animate({scrollTop:g(".wc-modal-shipping-method-settings").find("form").outerHeight()},500)):t.prop("checked",!t.is(":checked"))},_toggleRateRows:function(e){var t=g(e.currentTarget),o=t.closest("table"),n=o.find("thead"),a=o.find("tbody"),s=o.find("tfoot");t.closest("tr").removeClass("applied").siblings().removeClass("applied"),t.is(":checked")?t.closest("tr").addClass("selected"):t.closest("tr").removeClass("selected"),a.find("[type=checkbox]:checked").length?s.find(".add_row").hide("fast",function(){g(this).siblings(".remove_rows").show()}):s.find(".remove_rows").hide("fast",function(){g(this).siblings(".add_row").show()}),a.find("[type=checkbox]:checked").length===a.find("[type=checkbox]").length?n.find("input[type=checkbox]").prop("checked",!0):n.find("input[type=checkbox]").prop("checked",!1)},_addRateRows:function(e){e.preventDefault(),g("#wcsdm-table-rates tbody").append(wp.template("rates-list-input-table-row")).find("tr:last-child .field-distance").focus(),g("#woocommerce_wcsdm_gmaps_api_units").trigger("change"),g(".wc-modal-shipping-method-settings").scrollTop(g(".wc-modal-shipping-method-settings").find("form").outerHeight()),u._toggleNoRatesRow()},_removeRateRows:function(e){e.preventDefault();var t=g(e.currentTarget),o=t.closest("table");t.hide("fast",function(){g(this).siblings(".add_row").show()}),o.find("thead [type=checkbox]").prop("checked",!1),o.find("tbody [type=checkbox]:checked").each(function(e,t){g(t).closest("tr").remove()}),u._toggleNoRatesRow()},_toggleNoRatesRow:function(){g("#wcsdm-table-rates tbody tr").length?(g("#row-heading-bottom").hide().closest("table").find("thead, tbody, tfoot .row-heading-both").show(),g("#btn-ok").show()):(g("#row-heading-bottom").show().find(".add_row").show().closest("table").find("thead, tbody, tfoot .row-heading-both").hide(),g("#btn-ok").hide())}};g(document).ready(function(){u.init(wcsdm_params)})}(jQuery);