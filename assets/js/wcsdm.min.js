!function(p){"use strict";var g,c,h=!1,e=window.console.error;window.console.error=function(){h||1===arguments[0].toLowerCase().indexOf("google")||(h=!0,w._showMapError(arguments[0])),e.apply(e,arguments)};var o=0,w={_zoomLevel:16,_defaultLat:-6.175392,_defaultLng:106.827153,init:function(e){var a,n,s,i;w.params=e,w.params.showSettings&&setTimeout(function(){for(var e=!1,t=p(document).find(".wc-shipping-zone-method-type"),o=0;o<t.length;o++){var a=t[o];if(p(a).text()===w.params.methodTitle)return p(a).closest("tr").find(".row-actions .wc-shipping-zone-method-settings").trigger("click"),void(e=!0)}e||(p(".wc-shipping-zone-add-method").trigger("click"),p('select[name="add_method_id"]').val(w.params.methodId).trigger("change"))},200),p(document).on("click",".wc-shipping-zone-method-settings",function(){if(p(this).closest("tr").find(".wc-shipping-zone-method-type").text()!==w.params.methodTitle)return!1;p(".field-distance").trigger("change"),p("#woocommerce_wcsdm_gmaps_api_units").trigger("change"),p("#woocommerce_wcsdm_gmaps_api_key").trigger("input"),w._toggleNoRatesRow()}),p(document).on("input","#woocommerce_wcsdm_gmaps_api_key",(a=function(){w._initGoogleMaps()},n=500,function(){var e=this,t=arguments,o=s&&!i;clearTimeout(i),i=setTimeout(function(){i=null,s||a.apply(e,t)},n),o&&a.apply(e,t)})),p(document).on("change","#woocommerce_wcsdm_gmaps_api_units",function(){p(".field-groups.distance .field-group-item-units").text(w.params.i18n.distance[p(this).val()].unit),p('option[value="per_unit"]').text(w.params.i18n.distance[p(this).val()].perUnit)}),p(document).on("change","#woocommerce_wcsdm_gmaps_api_units",function(){p(".field-groups.distance .field-group-item-units").text(w.params.i18n.distance[p(this).val()].unit),p('option[value="per_unit"]').text(w.params.i18n.distance[p(this).val()].perUnit)}),p(document).on("change input",".field-distance",function(e){var t=p(e.currentTarget),o=parseInt(t.val());o<10?t.attr("step","1"):10<=o&&o<=50?t.attr("step","5"):t.attr("step","10")}),p(document).on("change","#wcsdm-table-rates tbody .wcsdm-input-dummy",function(e){p(e.currentTarget).closest("td").find(".wcsdm-input").val(p(e.currentTarget).val())}),p(document).on("change","#woocommerce_wcsdm_free",function(e){p(".free-shipping-yes_alt").closest("tr").hide(),"yes_alt"===p(e.currentTarget).val()&&p(".free-shipping-yes_alt").closest("tr").show()}),p(document).on("click",".advanced-rate-settings",function(e){e.preventDefault();var t=p(e.currentTarget).closest("tr").removeClass("applied");t.siblings().removeClass("applied"),t.find(".wcsdm-input").each(function(){p("#"+p(this).data("id")).val(p(this).val()).attr("name","").trigger("change")}),c=t.index(),o=Math.abs(t.closest("form").position().top),p(e.currentTarget).closest("section").find(".wcsdm-table-row-advanced").show().siblings().hide(),p("#btn-ok").hide().after(wp.template("btn-advanced")),p("#woocommerce_wcsdm_free").trigger("change")}),p(document).on("click","#btn-dummy",function(e){var a;e.preventDefault(),p("#wcsdm-table-advanced .wcsdm-input").each(function(){var e=p(this),t=e.val(),o=e.attr("id");(a=p("#wcsdm-table-rates tbody tr:eq("+c+")").addClass("applied").find(".wcsdm-input."+o).val(t)).hasClass("wcsdm-input-free")?a.closest("td").find(".dashicons").removeClass().addClass("dashicons").addClass("free-shipping-"+t):a.closest("td").find(".wcsdm-input-dummy").val(t),e.val("")}),p(e.currentTarget).closest("section").find(".wcsdm-table-row-advanced").hide().siblings().show(),p(e.currentTarget).remove(),p("#btn-ok").show(),p(".wc-modal-shipping-method-settings").animate({scrollTop:o},500),setTimeout(function(){a&&a.closest("tr").removeClass("applied")},1e3)}),p(document).on("change","#wcsdm-table-rates thead .select-item",w._toggleRateRowsBulk),p(document).on("change","#wcsdm-table-rates tbody .select-item",w._toggleRateRows),p(document).on("click","#wcsdm-table-rates .button.add_row",w._addRateRows),p(document).on("click","#wcsdm-table-rates .button.remove_rows",w._removeRateRows)},_initGoogleMaps:function(){p("#wcsdm-map-spinner").show(),p("#wcsdm-map-error").hide().empty(),p("#wcsdm-map-wrapper").hide().empty(),p("#wcsdm-lat-lng-wrap").hide();var e=p("#woocommerce_wcsdm_gmaps_api_key").val();if(e.length){p("#wcsdm-map-wrapper").closest("tr").show(),h=!1,window.google=void 0;var t="https://maps.googleapis.com/maps/api/js?libraries=geometry,places&key="+e+"&language="+w.params.language;p.getScript(t,function(){w._buildGoogleMaps()})}else p("#wcsdm-map-wrapper").closest("tr").hide()},_buildGoogleMaps:function(){var e=/^[-+]?[0-9]{1,7}(\.[0-9]+)?$/,t=p("#woocommerce_wcsdm_origin_lat").val(),o=p("#woocommerce_wcsdm_origin_lng").val(),a={lat:t=t.length&&e.exec(t)?parseFloat(t):w._defaultLat,lng:o=o.length&&e.exec(o)?parseFloat(o):w._defaultLng},n=wp.template("wcsdm-map-canvas"),s=wp.template("wcsdm-map-search");p("#wcsdm-map-canvas").length||p("#wcsdm-map-wrapper").append(n());var i=[],c=new google.maps.Map(document.getElementById("wcsdm-map-canvas"),{center:a,zoom:w._zoomLevel,mapTypeId:"roadmap"}),r=new google.maps.Marker({map:c,position:a,draggable:!0,icon:w.params.marker}),d=new google.maps.InfoWindow({maxWidth:350});t===w._defaultLat&&o===w._defaultLng?(d.setContent(w.params.i18n.dragMarker),d.open(c,r)):w._setLatLng(r.position,r,c,d),google.maps.event.addListener(r,"dragstart",function(){d.close()}),google.maps.event.addListener(r,"dragend",function(e){w._setLatLng(e.latLng,r,c,d)}),i.push(r),p("#wcsdm-map-search").length||p("#wcsdm-map-wrapper").append(s());var l=document.getElementById("wcsdm-map-search"),m=new google.maps.places.SearchBox(l);c.controls[google.maps.ControlPosition.TOP_LEFT].push(l),c.addListener("bounds_changed",function(){m.setBounds(c.getBounds())}),m.addListener("places_changed",function(){var e=m.getPlaces();if(0!==e.length){i.forEach(function(e){e.setMap(null)}),i=[];var t=new google.maps.LatLngBounds;e.forEach(function(e){e.geometry?(r=new google.maps.Marker({map:c,position:e.geometry.location,draggable:!0,icon:w.params.marker}),w._setLatLng(e.geometry.location,r,c,d),google.maps.event.addListener(r,"dragstart",function(){d.close()}),google.maps.event.addListener(r,"dragend",function(e){w._setLatLng(e.latLng,r,c,d)}),i.push(r),e.geometry.viewport?t.union(e.geometry.viewport):t.extend(e.geometry.location)):console.log("Returned place contains no geometry")}),c.fitBounds(t)}}),clearTimeout(g),g=setTimeout(function(){if(!h){var e=new google.maps.LatLng(-6.1762256,106.82295120000003),t=new google.maps.LatLng(-6.194891755155254,106.81979692219852);(new google.maps.DistanceMatrixService).getDistanceMatrix({origins:[e],destinations:[t],travelMode:"DRIVING",unitSystem:google.maps.UnitSystem.METRIC},function(e,t){"OK"===t?(p("#wcsdm-map-spinner").hide(),p("#wcsdm-map-wrapper").show(),p("#wcsdm-lat-lng-wrap").show()):console.log("DistanceMatrixRequestError",{status:t,response:e})})}},800)},_showMapError:function(e){p("#wcsdm-map-spinner").hide(),p("#wcsdm-map-wrapper").empty().hide(),p("#wcsdm-lat-lng-wrap").hide().find(".origin-coordinates").val("");p("#wcsdm-map-error").html(e.replace(/^([A-Za-z0-9\s]+):/,'<strong class="error-message">$1:</strong><hr />').replace(/(\b(https?|ftp|file):\/\/[-A-Z0-9+&@#\/%?=~_|!:,.;]*[-A-Z0-9+&@#\/%=~_|])/gi,'<a href="$1" target="_blank">$1</a>')).show()},_setLatLng:function(e,o,a,n){(new google.maps.Geocoder).geocode({latLng:e},function(e,t){t===google.maps.GeocoderStatus.OK&&e[0]&&(n.setContent(e[0].formatted_address),n.open(a,o),o.addListener("click",function(){n.open(a,o)}))}),a.setCenter(e),p("#woocommerce_wcsdm_origin_lat").val(e.lat()),p("#woocommerce_wcsdm_origin_lng").val(e.lng())},_toggleRateRowsBulk:function(e){var t=p(e.currentTarget),o=t.closest("table").find("tbody input[type=checkbox]");o.length?(o.prop("checked",t.is(":checked")).trigger("change"),t.is(":checked")&&p(".wc-modal-shipping-method-settings").animate({scrollTop:p(".wc-modal-shipping-method-settings").find("form").outerHeight()},500)):t.prop("checked",!t.is(":checked"))},_toggleRateRows:function(e){var t=p(e.currentTarget),o=t.closest("table"),a=o.find("thead"),n=o.find("tbody"),s=o.find("tfoot");t.closest("tr").removeClass("applied").siblings().removeClass("applied"),t.is(":checked")?t.closest("tr").addClass("selected"):t.closest("tr").removeClass("selected"),n.find("[type=checkbox]:checked").length?s.find(".add_row").hide("fast",function(){p(this).siblings(".remove_rows").show()}):s.find(".remove_rows").hide("fast",function(){p(this).siblings(".add_row").show()}),n.find("[type=checkbox]:checked").length===n.find("[type=checkbox]").length?a.find("input[type=checkbox]").prop("checked",!0):a.find("input[type=checkbox]").prop("checked",!1)},_addRateRows:function(e){e.preventDefault(),p("#wcsdm-table-rates tbody").append(wp.template("rates-list-input-table-row")).find("tr:last-child .field-distance").focus(),p("#woocommerce_wcsdm_gmaps_api_units").trigger("change"),p(".wc-modal-shipping-method-settings").scrollTop(p(".wc-modal-shipping-method-settings").find("form").outerHeight()),w._toggleNoRatesRow()},_removeRateRows:function(e){e.preventDefault();var t=p(e.currentTarget),o=t.closest("table");t.hide("fast",function(){p(this).siblings(".add_row").show()}),o.find("thead [type=checkbox]").prop("checked",!1),o.find("tbody [type=checkbox]:checked").each(function(e,t){p(t).closest("tr").remove()}),w._toggleNoRatesRow()},_toggleNoRatesRow:function(){p("#wcsdm-table-rates tbody tr").length?(p("#row-heading-bottom").hide().closest("table").find("thead, tbody, tfoot .row-heading-both").show(),p("#btn-ok").show()):(p("#row-heading-bottom").show().find(".add_row").show().closest("table").find("thead, tbody, tfoot .row-heading-both").hide(),p("#btn-ok").hide())}};p(document).ready(function(){w.init(wcsdm_params)})}(jQuery);