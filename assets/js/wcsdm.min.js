!function(w){"use strict";function t(n,a,s){var i;return function(){var e=this,t=arguments,o=s&&!i;clearTimeout(i),i=setTimeout(function(){i=null,s||n.apply(e,t)},a),o&&n.apply(e,t)}}var h,s,u=!1,e=window.console.error;window.console.error=function(){1!==arguments[0].indexOf("google.com")&&(u=!0,n._showMapError(arguments[0])),e.apply(e,arguments)};var o=0,n={_zoomLevel:16,init:function(e){var a=this;a.params=e,a.params.showSettings&&setTimeout(function(){for(var e=!1,t=w(document).find(".wc-shipping-zone-method-type"),o=0;o<t.length;o++){var n=t[o];if(w(n).text()===a.params.methodTitle)return w(n).closest("tr").find(".row-actions .wc-shipping-zone-method-settings").trigger("click"),void(e=!0)}e||(w(".wc-shipping-zone-add-method").trigger("click"),w('select[name="add_method_id"]').val(a.params.methodId).trigger("change"))},200),w(document).on("click",".wc-shipping-zone-method-settings",function(){if(w(this).closest("tr").find(".wc-shipping-zone-method-type").text()!==a.params.methodTitle)return!1;w(".field-distance").trigger("change"),w("#woocommerce_wcsdm_gmaps_api_units").trigger("change"),w("#woocommerce_wcsdm_gmaps_api_key").trigger("input"),a._toggleNoRatesRow()}),w(document).on("input","#woocommerce_wcsdm_gmaps_api_key",t(function(){a._initGoogleMaps()},250)),w(document).on("change","#woocommerce_wcsdm_origin_lat, #woocommerce_wcsdm_origin_lng",t(function(){w("#woocommerce_wcsdm_origin_lat").val().length&&w("#woocommerce_wcsdm_origin_lng").val().length&&a._initGoogleMaps()},250)),w(document).on("change","#woocommerce_wcsdm_gmaps_api_units",function(){w(".field-groups.distance .field-group-item-units").text(a.params.i18n.distance[w(this).val()].unit),w('option[value="per_unit"]').text(a.params.i18n.distance[w(this).val()].perUnit)}),w(document).on("change","#woocommerce_wcsdm_gmaps_api_units",function(){w(".field-groups.distance .field-group-item-units").text(a.params.i18n.distance[w(this).val()].unit),w('option[value="per_unit"]').text(a.params.i18n.distance[w(this).val()].perUnit)}),w(document).on("change input",".field-distance",function(e){var t=w(e.currentTarget),o=parseInt(t.val());o<10?t.attr("step","1"):10<=o&&o<=50?t.attr("step","5"):t.attr("step","10")}),w(document).on("change","#wcsdm-table-rates tbody .wcsdm-input-dummy",function(e){w(e.currentTarget).closest("td").find(".wcsdm-input").val(w(e.currentTarget).val())}),w(document).on("change","#woocommerce_wcsdm_free",function(e){w(".free-shipping-yes_alt").closest("tr").hide(),"yes_alt"===w(e.currentTarget).val()&&w(".free-shipping-yes_alt").closest("tr").show()}),w(document).on("click",".advanced-rate-settings",function(e){e.preventDefault();var t=w(e.currentTarget).closest("tr").removeClass("applied");t.siblings().removeClass("applied"),t.find(".wcsdm-input").each(function(){w("#"+w(this).data("id")).val(w(this).val()).attr("name","").trigger("change")}),s=t.index(),o=Math.abs(t.closest("form").position().top),w(e.currentTarget).closest("section").find(".wcsdm-table-row-advanced").show().siblings().hide(),w("#btn-ok").hide().after(wp.template("btn-advanced")),w("#woocommerce_wcsdm_free").trigger("change")}),w(document).on("click","#btn-dummy",function(e){var n;e.preventDefault(),w("#wcsdm-table-advanced .wcsdm-input").each(function(){var e=w(this),t=e.val(),o=e.attr("id");(n=w("#wcsdm-table-rates tbody tr:eq("+s+")").addClass("applied").find(".wcsdm-input."+o).val(t)).hasClass("wcsdm-input-free")?n.closest("td").find(".dashicons").removeClass().addClass("dashicons").addClass("free-shipping-"+t):n.closest("td").find(".wcsdm-input-dummy").val(t),e.val("")}),w(e.currentTarget).closest("section").find(".wcsdm-table-row-advanced").hide().siblings().show(),w(e.currentTarget).remove(),w("#btn-ok").show(),w(".wc-modal-shipping-method-settings").animate({scrollTop:o},500),setTimeout(function(){n&&n.closest("tr").removeClass("applied")},1e3)}),w(document).on("change","#wcsdm-table-rates thead .select-item",a._toggleRateRowsBulk),w(document).on("change","#wcsdm-table-rates tbody .select-item",a._toggleRateRows),w(document).on("click","#wcsdm-table-rates .button.add_row",a._addRateRows),w(document).on("click","#wcsdm-table-rates .button.remove_rows",a._removeRateRows)},_initGoogleMaps:function(){var e=this;w("#wcsdm-map-error").hide().empty(),w("#wcsdm-map-wrapper").hide().empty(),w("#wcsdm-lat-lng-wrap").hide();var t=w("#woocommerce_wcsdm_gmaps_api_key").val();if(t.length){w("#wcsdm-map-wrapper").closest("tr").show(),u=!1,void 0!==window.google&&(window.google=void 0);var o="https://maps.googleapis.com/maps/api/js?libraries=geometry,places&key="+t+"&language="+e.params.language;w.getScript(o,function(){e._buildGoogleMaps()})}else w("#wcsdm-map-wrapper").closest("tr").hide()},_buildGoogleMaps:function(){var o=this,e=-6.175392,t=106.827153,n=w("#woocommerce_wcsdm_origin_lat").val(),a=w("#woocommerce_wcsdm_origin_lng").val(),s={lat:n=n.length?parseFloat(n):e,lng:a=a.length?parseFloat(a):t},i=wp.template("wcsdm-map-canvas"),c=wp.template("wcsdm-map-search");w("#wcsdm-map-canvas").length||w("#wcsdm-map-wrapper").append(i());var r=[],d=new google.maps.Map(document.getElementById("wcsdm-map-canvas"),{center:s,zoom:o._zoomLevel,mapTypeId:"roadmap"}),l=new google.maps.Marker({map:d,position:s,draggable:!0,icon:o.params.marker}),m=new google.maps.InfoWindow({maxWidth:350});n===e&&a===t?(m.setContent(o.params.i18n.dragMarker),m.open(d,l)):o._setLatLng(l.position,l,d,m),google.maps.event.addListener(l,"dragstart",function(){m.close()}),google.maps.event.addListener(l,"dragend",function(e){o._setLatLng(e.latLng,l,d,m)}),r.push(l),w("#wcsdm-map-search").length||w("#wcsdm-map-wrapper").append(c());var p=document.getElementById("wcsdm-map-search"),g=new google.maps.places.SearchBox(p);d.controls[google.maps.ControlPosition.TOP_LEFT].push(p),d.addListener("bounds_changed",function(){g.setBounds(d.getBounds())}),g.addListener("places_changed",function(){var e=g.getPlaces();if(0!==e.length){r.forEach(function(e){e.setMap(null)}),r=[];var t=new google.maps.LatLngBounds;e.forEach(function(e){e.geometry?(l=new google.maps.Marker({map:d,position:e.geometry.location,draggable:!0,icon:o.params.marker}),o._setLatLng(e.geometry.location,l,d,m),google.maps.event.addListener(l,"dragstart",function(){m.close()}),google.maps.event.addListener(l,"dragend",function(e){o._setLatLng(e.latLng,l,d,m)}),r.push(l),e.geometry.viewport?t.union(e.geometry.viewport):t.extend(e.geometry.location)):console.log("Returned place contains no geometry")}),d.fitBounds(t)}}),w("#wcsdm-map-wrapper").show(),w("#wcsdm-lat-lng-wrap").show(),clearTimeout(h),h=setTimeout(function(){if(!u){var e=new google.maps.LatLng(-6.1762256,106.82295120000003),t=new google.maps.LatLng(-6.194891755155254,106.81979692219852);(new google.maps.DistanceMatrixService).getDistanceMatrix({origins:[e],destinations:[t],travelMode:"DRIVING",unitSystem:google.maps.UnitSystem.METRIC},function(e,t){console.log("DistanceMatrix.testRequest",{status:t,response:e})})}},800)},_showMapError:function(e){w("#wcsdm-map-wrapper").empty().hide(),w("#wcsdm-lat-lng-wrap").hide().find(".origin-coordinates").val("");w("#wcsdm-map-error").html(e.replace(/(\b(https?|ftp|file):\/\/[-A-Z0-9+&@#\/%?=~_|!:,.;]*[-A-Z0-9+&@#\/%=~_|])/gi,'<a href="$1" target="_blank">$1</a>')).show()},_setLatLng:function(e,o,n,a){(new google.maps.Geocoder).geocode({latLng:e},function(e,t){t===google.maps.GeocoderStatus.OK&&e[0]&&(a.setContent(e[0].formatted_address),a.open(n,o),o.addListener("click",function(){a.open(n,o)}))}),n.setCenter(e),w("#woocommerce_wcsdm_origin_lat").val(e.lat()),w("#woocommerce_wcsdm_origin_lng").val(e.lng())},_toggleRateRowsBulk:function(e){var t=w(e.currentTarget),o=t.closest("table").find("tbody input[type=checkbox]");o.length?(o.prop("checked",t.is(":checked")).trigger("change"),t.is(":checked")&&w(".wc-modal-shipping-method-settings").animate({scrollTop:w(".wc-modal-shipping-method-settings").find("form").outerHeight()},500)):t.prop("checked",!t.is(":checked"))},_toggleRateRows:function(e){var t=w(e.currentTarget),o=t.closest("table"),n=o.find("thead"),a=o.find("tbody"),s=o.find("tfoot");t.closest("tr").removeClass("applied").siblings().removeClass("applied"),t.is(":checked")?t.closest("tr").addClass("selected"):t.closest("tr").removeClass("selected"),a.find("[type=checkbox]:checked").length?s.find(".add_row").hide("fast",function(){w(this).siblings(".remove_rows").show()}):s.find(".remove_rows").hide("fast",function(){w(this).siblings(".add_row").show()}),a.find("[type=checkbox]:checked").length===a.find("[type=checkbox]").length?n.find("input[type=checkbox]").prop("checked",!0):n.find("input[type=checkbox]").prop("checked",!1)},_addRateRows:function(e){e.preventDefault(),w("#wcsdm-table-rates tbody").append(wp.template("rates-list-input-table-row")).find("tr:last-child .field-distance").focus(),w("#woocommerce_wcsdm_gmaps_api_units").trigger("change"),w(".wc-modal-shipping-method-settings").scrollTop(w(".wc-modal-shipping-method-settings").find("form").outerHeight()),n._toggleNoRatesRow()},_removeRateRows:function(e){e.preventDefault();var t=w(e.currentTarget),o=t.closest("table");t.hide("fast",function(){w(this).siblings(".add_row").show()}),o.find("thead [type=checkbox]").prop("checked",!1),o.find("tbody [type=checkbox]:checked").each(function(e,t){w(t).closest("tr").remove()}),n._toggleNoRatesRow()},_toggleNoRatesRow:function(){w("#wcsdm-table-rates tbody tr").length?w("#row-heading-bottom").hide().closest("table").find("thead, tbody, tfoot .row-heading-both").show():w("#row-heading-bottom").show().find(".add_row").show().closest("table").find("thead, tbody, tfoot .row-heading-both").hide()}};w(document).ready(function(){n.init(wcsdm_params)})}(jQuery);